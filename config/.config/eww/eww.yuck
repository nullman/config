;;==============================================================================
;; .config/eww/eww.yuck
;;
;; Elkowars Wacky Widgets configuration.
;;
;; Reference: https://github.com/elkowar/eww/tree/master/examples/eww-bar
;; Reference: https://github.com/ikz87/dots-2.0/tree/main/Configs/eww/mybar
;; Reference: https://github.com/rxyhn/tokyo/tree/main/config/eww/bar
;;==============================================================================

;;------------------------------------------------------------------------------
;; Polls
;;------------------------------------------------------------------------------

(defpoll active-desktop :interval "500ms" "bspc query -D -d --names")

(defpoll music-info :interval "2s" "~/bin/mpc-playing")

(defpoll music-state :interval "2s" "mpc | grep -q '^\\[playing\\]' && echo 'Ó´ì' || echo 'Ó´ë'")

(defpoll mute :interval "500ms" "[[ $(pamixer --get-mute) == true ]] && echo 'üîá' || echo 'üîä'")

(defpoll volume :interval "500ms" "[[ $(pamixer --get-mute) == true ]] && echo '0' || pamixer --get-volume")

(defpoll brightness :interval "500ms" "light -G | cut -c 1-2")

(defpoll weather :interval "300s" "scripts/weather 55433 icon")

(defpoll weather-status :interval "300s" "scripts/weather 55433 status")

(defpoll battery :interval "2s" "scripts/battery")

(defpoll battery-capacity :interval "5s" "cat /sys/class/power_supply/BAT0/capacity")

(defpoll battery-status :interval "5s" "cat /sys/class/power_supply/BAT0/status")

(defpoll clock :interval "500ms" "scripts/clock")

;;(defpoll time :interval "500ms" "date '+%a %Y-%m-%d %H:%M'")

;;------------------------------------------------------------------------------
;; Helper Widgets
;;------------------------------------------------------------------------------

(defwidget metric [label value onchange ?onclick ?tooltip]
  (box :class "metric"
       :orientation "h"
       :space-evenly false
       :tooltip tooltip
       (box :class "label"
            (button :onclick onclick label))
       (scale :min 0
              :max 101
              :active {onchange != ""}
              :value value
              :onchange onchange)))

(defwidget workspace [label value onclick ?tooltip]
  (box :class {value == active-desktop ? "highlight" : "label"}
       :tooltip tooltip
       (button :onclick onclick label)))

;;------------------------------------------------------------------------------
;; Section Widgets
;;------------------------------------------------------------------------------

(defwidget left-bar []
  (box :class "left-bar"
       :orientation "h"
       :space-evenly false
       :halign "start"
       :spacing 10
       ;; application search
       (box :class "label"
            :tooltip "Application Search"
            (button :onclick "rofi -modi drun -show drun &" "Óöè "))
       ;; launcher menu
       ;; (box :class "label"
       ;;      :tooltip "Launcher Menu"
       ;;      (button :onclick "~/bin/rofi-menu" "ÔÄä "))
       ;; window selector
       (box :class "label"
            :tooltip "Window Selector"
            (button :onclick "rofi -modi window -show window &" "Ôîû "))
       ;; symbols: ÔÑ† ÓöÉ ÔÉ∂ Óò≤ ÔÉ† ÔÇ¨ Ôâ© ÔÅº ÔÅª ÔÅµ ÔÇÜ ÔÉÉ Óò• ÔÄæ ÔÄΩ ÔÑâ ÔÑ° ÔÑ® Ôáã Ôáª ÔãÜ Ôà≥ Óòï
       (workspace :label "1 ÓöÉ " :value "1" :onclick "bspc desktop --focus '^1'" :tooltip "Workspace 1")
       (workspace :label "2 Óò≤ " :value "2" :onclick "bspc desktop --focus '^2'" :tooltip "Workspace 2")
       (workspace :label "3 ÔÉ† " :value "3" :onclick "bspc desktop --focus '^3'" :tooltip "Workspace 3")
       (workspace :label "4 ÔÇ¨ " :value "4" :onclick "bspc desktop --focus '^4'" :tooltip "Workspace 4")
       (workspace :label "5 ÔÅº " :value "5" :onclick "bspc desktop --focus '^5'" :tooltip "Workspace 5")
       (workspace :label "6 ÔÅµ " :value "6" :onclick "bspc desktop --focus '^6'" :tooltip "Workspace 6")
       (workspace :label "7 ÔÇÜ " :value "7" :onclick "bspc desktop --focus '^7'" :tooltip "Workspace 7")
       (workspace :label "8 ÔÉÉ " :value "8" :onclick "bspc desktop --focus '^8'" :tooltip "Workspace 8")
       (workspace :label "9 ÔÄæ " :value "9" :onclick "bspc desktop --focus '^9'" :tooltip "Workspace 9")
       (workspace :label "10 ÔÑâ " :value "10" :onclick "bspc desktop --focus '^10'" :tooltip "Workspace 10")))

(defwidget center-bar []
  (box :class "center-bar"
       :orientation "h"
       :space-evenly false
       :halign "center"
       :spacing 10
       (box :class "music-state"
            (button :onclick "mpc toggle" music-state))
       (box :class "music-info"
            (button :onclick "mpc toggle" {music-info != "" ? "${music-info}" : ""}))))

(defwidget right-bar []
  (box :class "right-bar"
       :orientation "h"
       :space-evenly false
       :halign "end"
       :spacing 10
       (box :class "label"
            :tooltip weather-status
            (button :onclick "curl --silent wttr.in | head -n -2 | sed 's/\\x1B\\[[0-9;]*[a-zA-Z]//g' | yad --text-info --width=1138 --height=760 --no-buttons" weather))
       (metric :label mute
               :value volume
               :onchange "pactl -- set-sink-volume 0 {}%"
               :onclick "pactl -- set-sink-mute 0 toggle"
               :tooltip "Volume: ${volume}%")
       (metric :label "ÔÇ£"
               :value brightness
               :onchange "light -S {}"
               :tooltip "Brightness: ${brightness}%")
       (metric :label "Ô°ö"
               :value {EWW_RAM.used_mem_perc}
               :onchange ""
               :tooltip "RAM Used: ${EWW_RAM.used_mem_perc}%")
       (metric :label "Û∞Üº"
               :value {round((1 - (EWW_DISK["/"].free / EWW_DISK["/"].total)) * 100, 0)}
               :onchange ""
               :tooltip "Disk Used: ${round((1 - (EWW_DISK["/"].free / EWW_DISK["/"].total)) * 100, 0)}%")
       (box :class "label"
            :tooltip "${battery-capacity}%, ${battery-status}"
            battery)
       (box :class "label"
            (button :onclick "" clock))))

(defwidget bar []
  (centerbox :orientation "h"
             (left-bar)
             (center-bar)
             (right-bar)))

;;------------------------------------------------------------------------------
;; Windows
;;------------------------------------------------------------------------------

(defwindow bar
  :monitor 0
  :windowtype "dock"
  :geometry (geometry :x "0%"
                      :y "0%"
                      :width "100%"
                      :height "12px"
                      :anchor "bottom center")
  :reserve (struts :side "bottom"
                   :distance "12px")
  (bar))

;;==============================================================================
;; End of File
;;==============================================================================
