#!/usr/bin/env bash
#===============================================================================
# .xprofile
#
# X Initialization Configuration
#
# Author: Kyle W T Sherman <kylewsherman@gmail.com>
#===============================================================================

# check if executable command is found in the path
_command() {
    command -v "$1" >/dev/null 2>&1
}

# run executable command if found in the path
_run() {
    command -v "$1" >/dev/null 2>&1 && "$@"
}

# source script if found in the path
_source() {
    [ -f "$1" ] && source "$@"
}

# add to the run path
export runpath="${runpath}:${HOME}/.xprofile"
logger "Running: ${HOME}/.xprofile"

# exit if not running under X11
[ -z "${DISPLAY}" ] && return 1

# set video resolution via xrandr
[ -x ${HOME}/.xrandr ] && ${HOME}/.xrandr >/dev/null 2>&1

# xresources
_command xrdb && [ -f /etc/X11/xinit/.Xresources ] && xrdb -merge /etc/X11/xinit/.Xresources
_command xrdb && [ -f ${HOME}.Xresources ] && xrdb -merge ${HOME}/.Xresources

# xmodmap
_command xmodmap && [ -f /etc/X11/xinit/.Xmodmap ] && xmodmap /etc/X11/xinit/.Xmodmap
_command xmodmap && [ -f ${HOME}/.Xmodmap ] && xmodmap ${HOME}/.Xmodmap

# # disable insert key
# _command xkbcomp && xkbcomp ${DISPLAY} - | sed 's/ Insert / NoSymbol /' | xkbcomp - ${DISPLAY} >/dev/null 2>&1

# setxkbmap key behavior modifications
#   caps lock  -> control
#   both shift -> toggle caps lock
_run setxkbmap -option 'shift:both_capslock,caps:ctrl_modifier'

# # setxkbmap key behavior modifications
# #   caps lock  -> control
# #   both shift -> toggle caps lock
# #   shift      -> cancel caps lock
# _run setxkbmap -option 'shift:both_capslock_cancel,caps:ctrl_modifier'

# # xbindkeys
# pkill -u ${USER} xbindkeys >/dev/null 2>&1
# [ -f ${HOME}/.xbindkeysrc ] && _run xbindkeys >/dev/null 2>&1

# # sxhkd
# _run ${HOME}/bin/run-sxhkd

# set no energy saving, mouse acceleration rate, and keyboard acceleration rate
_run xset -dpms s off b off m 2/1 4 r rate 500 35 >/dev/null 2>&1

# # set mouse scrolling speed
# _run imwheel -b 4 8 >/dev/null 2>&1

# set background color and mouse pointer
#_run xsetroot -solid black -cursor_name left_ptr >/dev/null 2>&1

# # set no energy saving, mouse acceleration rate, and keyboard acceleration rate
# if [ -n "$(greppr screen_blank)" ] ; then
#     _run xset -dpms s on b off m 2/1 4 r rate 500 35 >/dev/null 2>&1
# else
#     _run xset -dpms s off b off m 2/1 4 r rate 500 35 >/dev/null 2>&1
# fi

# turn numlock on
if [ "$(uname -n)" == "dozer" ] ; then
    _run numlockx
fi

# xhost
#_run xhost +localhost >/dev/null 2>&1
#_run xhost +mouse1 >/dev/null 2>&1

# start wm
#[ -z "$(greppr window_manager)" ] || ps ux | grep -v grep | grep -q window_manager || (exec $(getpr window_manager) &) >/dev/null 2>&1

# select a window manager
#exec selectwm

# use qt5ct for Qt themeing
export QT_QPA_PLATFORMTHEME="qt5ct"

# restore rotation
# _source ${HOME}/.raspad-rotate-restore

#===============================================================================
# End of File
#===============================================================================
