#!/usr/bin/env bash
#===============================================================================
# application-launcher
#
# Launch select group of applications in the background.
#
# If ~/.dev exists, then only pre-check terminal and editor.
#
# Author: Kyle W T Sherman <kylewsherman@gmail.com>
#===============================================================================

apps=$(cat ${HOME}/.applications | sed -n '/^[^ #]/p')

cmd="yad --width=512 --height=384 --list --checklist --column 'Run' --column 'Application' 2>/dev/null"
for app in ${apps} ; do
    if [[ ! -f ${HOME}/.dev ]] || [[ "${app}" == "alacritty" ]] || [[ "${app}" == "emacs" ]] ; then
        cmd="${cmd} TRUE ${app}"
    else
        cmd="${cmd} FALSE ${app}"
    fi
done

#eval "${cmd} 2>/dev/null"
launch=$(eval "${cmd} 2>/dev/null")

for line in ${launch} ; do
    app=$(echo "${line}" | sed 's/^.*|\(.*\)|$/\1/')
    #echo "app: ${app}"
    if [[ "$(uname -n)" == "dom0" ]] ; then
        #echo "${app}"
        if [[ "${app:0:5}" == "dom0:" ]] ; then
            ${app} >/dev/null 2>&1 &
        elif [[ "${app:0:9}" == "personal:" ]] ; then
            qvm-run personal "${app:9} >/dev/null 2>&1 &"
        else
            ${app} >/dev/null 2>&1 &
        fi
    else
        if [[ $(command -v ${app}) ]] ; then
            if [[ ! $(pgrep -u ${USER} -f ${app}) ]] ; then
                if [[ "${app}" == "alacritty" ]] ; then
                    alacritty -e ${HOME}/bin/run-screen >/dev/null 2>&1 &
                else
                    #echo "${app}"
                    eval ${app} >/dev/null 2>&1 &
                fi
            fi
        else
            notify-send -u critical "${app} not installed"
        fi
    fi
done

#===============================================================================
# End of File
#===============================================================================
