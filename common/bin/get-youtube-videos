#!/usr/bin/env bash
#===============================================================================
# get-youtube-videos
#
# Grab the latest YouTube videos from a curated list.
#
# Author: Kyle W T Sherman
#===============================================================================

basedir="/mnt/synology/video"
#basedir="${HOME}/synology/video"

channels=(
#   "3Blue1Brown                      | Science              | https://www.youtube.com/c/3blue1brown/videos"
    "8-Bit Keys                       | Computer/Retro       | https://www.youtube.com/c/8BitKeys/videos"
    "8-Bit Show And Tell              | Computer/Retro       | https://www.youtube.com/c/8BitShowAndTell/videos"
    "Action Retro                     | Computer/Retro       | https://www.youtube.com/c/ActionRetro/videos"
    "Adrian's Digital Basement        | Computer/Retro       | https://www.youtube.com/c/adriansdigitalbasement/videos"
    "Adrian's Digital Basement ][     | Computer/Retro       | https://www.youtube.com/channel/UCbtwi4wK1YXd9AyV_4UcE6g/videos"
    "AngeTheGreat                     | Computer/Development | https://www.youtube.com/channel/UCV0t1y4h_6-2SqEpXBXgwFQ/videos"
##    "Back Office Show                 | Computer/Retro       | https://www.youtube.com/c/backofficeshow/videos"
    "Baggers                          | Computer/Development | https://www.youtube.com/user/CBaggers/videos"
    "Ben Eater                        | Computer/Hardware    | https://www.youtube.com/c/BenEater/videos"
    "Ben Heck Hacks                   | Computer/Hardware    | https://www.youtube.com/c/BenHeckHacks/videos"
#   "Blue OS Museum                   | Computer/Retro       | https://www.youtube.com/channel/UCO6vmCYZl7ZhEydFGi76iaw/videos"
#   "Chris Titus Tech                 | Computer/General     | https://www.youtube.com/c/ChrisTitusTech/videos"
#   "Chyrosran22 ???                  | Computer/Retro       | https://www.youtube.com/user/Chyrosran22/videos"
    "Commodore Amiga Demos            | Computer/Retro       | https://www.youtube.com/playlist?list=PLnmLOQIDmUvUgbvY-Jq0txuYWYgWVcOOS"
    "Commodore 64 Demos               | Computer/Retro       | https://www.youtube.com/playlist?list=PLnmLOQIDmUvVn43FHdakSTY_W_EuoVwnT"
#   "Computerphile                    | Computer/Development | https://www.youtube.com/user/Computerphile/videos"
#   "CuriousMarc                      | Science              | https://www.youtube.com/c/CuriousMarc/videos"
    "Dave's Garage                    | Computer/Retro       | https://www.youtube.com/c/DavesGarage/videos"
#   "Doctor Volt                      | Computer/Retro       | https://www.youtube.com/c/DoctorVolt/videos"
#   "DUST                             | Show                 | https://www.youtube.com/c/watchdust/videos"
    "EmacsConf                        | Computer/Emacs       | https://www.youtube.com/c/EmacsConf/videos"
    "Emacs Rocks                      | Computer/Emacs       | https://www.youtube.com/user/emacsrocks/videos"
#   "ETA Prime                        | Computer/Retro       | https://www.youtube.com/c/ETAPRIME/videos"
#   "ExplainingComputers              | Computer/General     | https://www.youtube.com/c/explainingcomputers/videos"
    "Flux Harmonic                    | Computer/Emacs       | https://www.youtube.com/c/FluxHarmonicLive/videos"
    "FreeDOS                          | Computer/Retro       | https://www.youtube.com/c/FreeDOSProject/videos"
    "Gavin Freeborn                   | Computer/Emacs       | https://www.youtube.com/c/GavinFreeborn/videos"
#   "GeekBits                         | Computer/Retro       | https://www.youtube.com/c/GeekBits/videos"
#   "Handheld Computing               | Computer/Retro       | https://www.youtube.com/c/HandheldComputing/videos"
    "Hey Birt                         | Computer/Retro       | https://www.youtube.com/c/HeyBirt/videos"
    "Jake B                           | Computer/Emacs       | https://www.youtube.com/c/JakeBox0/videos"
#   "James Sharman                    | Computer/Hardware    | https://www.youtube.com/c/weirdboyjim/videos"
#   "Jan Beta                         | Computer/Retro       | https://www.youtube.com/c/JanBeta"
    "Kaveh808                         | Computer/Development | https://www.youtube.com/channel/UCHNK9EcrAwP7djlwQN4C_tg/videos"
#   "LGR                              | Computer/Retro       | https://www.youtube.com/c/Lazygamereviews/videos"
#   "LGR Blerbs                       | Computer/Retro       | https://www.youtube.com/c/LGRBlerbs/videos"
    "Lukewh, Emacs                    | Computer/Emacs       | https://www.youtube.com/playlist?list=PLNJWazvift25KnHDwYlhwrrgr60wtpQOB"
    "lxsameer                         | Computer/Emacs       | https://www.youtube.com/c/lxsameer/videos"
#   "Mac84                            | Computer/Retro       | https://www.youtube.com/c/Mac84/videos"
    "Matt Heffernan Slithy Games      | Computer/Development | https://www.youtube.com/c/slithymatt/videos"
    "Me, Myself, and Die              | Game                 | https://www.youtube.com/c/MeMyselfandDieRPG/videos"
#   "Michael MJD                      | Computer/Retro       | https://www.youtube.com/c/MichaelMJD/videos"
#   "Mr Lurch's Things                | Computer/Retro       | https://www.youtube.com/c/MrLurchsThings"
#   "NDC Conferences                  | Computer/Development | https://www.youtube.com/c/NDCConferences/videos"
#   "Noel's Retro Lab                 | Computer/Retro       | https://www.youtube.com/c/NoelsRetroLab/videos"
#   "OldTechBloke ???                 | Computer/Retro       | https://www.youtube.com/c/OldTechBloke/videos"
#   "Paul Scinocca (Duluth Ships)     | Scenic               | https://www.youtube.com/c/PaulScinocca/videos"
    "PhilsComputerLab                 | Computer/Retro       | https://www.youtube.com/c/philscomputerlab/videos"
    "Protesilaos Stavrou              | Computer/Emacs       | https://www.youtube.com/c/ProtesilaosStavrou/videos"
    "Retro Hack Shack                 | Computer/Retro       | https://www.youtube.com/c/RetroHackShack/videos"
    "Retro Recipes                    | Computer/Retro       | https://www.youtube.com/c/Perifractic/videos"
    "root42                           | Computer/Development | https://www.youtube.com/c/root42/videos"
    "RossDM - Puzzle Solving          | Game                 | https://www.youtube.com/c/RossDM/videos"
    "RMC, The Cave                    | Computer/Retro       | https://www.youtube.com/c/RMCRetro/videos"
#   "Stand-up Maths                   | Science              | https://www.youtube.com/user/standupmaths/videos"
#   "Strange Loop Conference          | Computer/Development | https://www.youtube.com/c/StrangeLoopConf/videos"
    "System Crafters                  | Computer/Emacs       | https://www.youtube.com/c/SystemCrafters/videos"
#   "TechHut                          | Computer/Retro       | https://www.youtube.com/c/TechHutHD/videos"
    "Tech Tangents                    | Computer/Retro       | https://www.youtube.com/c/AkBKukU/videos"
#   "Techmoan                         | Computer/Retro       | https://www.youtube.com/c/Techmoan/videos"
    "TexElec                          | Computer/Retro       | https://www.youtube.com/c/TexElec/videos"
    "The 8-Bit Guy                    | Computer/Retro       | https://www.youtube.com/c/The8BitGuy/videos"
#   "The Centre for Computing History | Computer/Retro       | https://www.youtube.com/c/TheCentreforComputingHistory/videos"
#   "The Phintage Collector           | Computer/Retro       | https://www.youtube.com/c/THEPHINTAGECOLLECTOR/videos"
    "The Retro Shack                  | Computer/Retro       | https://www.youtube.com/c/TheRetroShack/videos"
#   "TheGeekPub                       | Computer/Retro       | https://www.youtube.com/c/TheGeekPub/videos"
#   "This Does Not Compute            | Computer/Retro       | https://www.youtube.com/c/ThisDoesNotCompute/videos"
##    "Tsoding Daily                    | Computer/Development | https://www.youtube.com/c/TsodingDaily/videos"
#   "Usagi Electric                   | Computer/Retro       | https://www.youtube.com/c/Nakazoto/videos"
#   "Veritasium                       | Science              | https://www.youtube.com/c/veritasium/videos"
#   "Vsauce2                          | Science              | https://www.youtube.com/user/Vsauce2/videos"
)

_usage() {
    cat <<EOF
Usage: $(basename $0) [OPTIONS] [CHANNEL]
Grab the latest YouTube videos from a curated list.
  OPTIONS:
  -l, --list             display video list names
  -r, --restart          download any missing videos from all lists
  -r, --restart CHANNEL  download any missing videos from CHANNEL
  -h, --help             show help (this message)
  CHANNEL                download videos from CHANNEL
EOF
}

_download() {
    archive="$1"
    listname="$2"

    [[ -n "${listname}" ]] && echo "List: ${listname}"

    for ((x = 0; x < ${#channels[@]}; x += 1)) ; do
        channel=$(echo "${channels[$x]}" | sed 's/ *|/|/g ; s/| */|/g')
        name=$(echo "${channel}" | cut -d '|' -f 1)
        dir=$(echo "${channel}" | cut -d '|' -f 2)
        url=$(echo "${channel}" | cut -d '|' -f 3)
        echo "|${name}|${dir}|${url}|"
        if [[ -z "${listname}" || "${name}" == "${listname}" ]] ; then
            path="${basedir}/${dir}/${name}"
            echo
            echo "${url} -> ${path}"
            echo
            mkdir -p "${path}"
            cd "${path}" && \
                yt-dlp --format "bv*+ba/b" \
                       --format-sort "res:1080,res:720,res:480" \
                       --playlist-reverse \
                       ${archive} \
                       --output "${name} - %(release_date>%Y-%m-%d,upload_date>%Y-%m-%d|Unknown)s - %(title)s.%(ext)s" \
                       "${url}"
        fi
    done
}

archive="--download-archive ${HOME}/.yt-dlp-download-archive"

# handle command line arguments
while true ; do
    case $1 in
        -l|--list)
            for ((x = 0; x < ${#channels[@]}; x += 1)) ; do
                echo "${channels[$x]}" | sed 's/ *|.*$//'
            done
            exit 0
            ;;
        -r|--restart)
            listname=
            if [[ -n "$2" ]] ; then
                listname="$2"
                shift
            fi
            archive="--no-download-archive"
            _download "${archive}" "${listname}"
            exit 0
            ;;
        -h|-\?|--help)
            _usage 0
            exit 0
            ;;
        --)
            shift
            break
            ;;
        -?*)
            echo -e "Invalid option: $1" >&2
            _usage
            exit 1
            ;;
        *)
            break
            ;;
    esac
    shift
done

listname=
[[ -n "$1" ]] && listname="$1"
_download "${archive}" "${listname}"

exit 0

#===============================================================================
# End of File
#===============================================================================
