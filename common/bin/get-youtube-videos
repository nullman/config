#!/usr/bin/env bash
#===============================================================================
# get-youtube-videos
#
# Grab the latest YouTube videos from a curated list.
#
# Author: Kyle W T Sherman
#===============================================================================

basedir="/mnt/synology/video/Internet Show"
tempdir="/tmp/get-youtube-videos"

channels=(
#    "8-Bit Keys                      | https://www.youtube.com/c/8BitKeys/videos"
#    "8-Bit Show And Tell             | https://www.youtube.com/c/8BitShowAndTell/videos"
#    "Action Retro                    | https://www.youtube.com/c/ActionRetro/videos"
    "Adrian's Digital Basement       | https://www.youtube.com/c/adriansdigitalbasement/videos"
    "Adrian's Digital Basement ][    | https://www.youtube.com/channel/UCbtwi4wK1YXd9AyV_4UcE6g/videos"
    "Ben Eater                       | https://www.youtube.com/c/BenEater/videos"
#    "Ben Heck Hacks                  | https://www.youtube.com/c/BenHeckHacks/videos"
#    "Commodore Amiga Demos           | https://www.youtube.com/playlist?list=PLnmLOQIDmUvUgbvY-Jq0txuYWYgWVcOOS"
#    "Commodore 64 Demos              | https://www.youtube.com/playlist?list=PLnmLOQIDmUvVn43FHdakSTY_W_EuoVwnT"
#    "Dave's Garage                   | https://www.youtube.com/c/DavesGarage/videos"
#    "DUST                            | https://www.youtube.com/c/watchdust/videos"
#    "EmacsConf                       | https://www.youtube.com/c/EmacsConf/videos"
#    "Emacs Rocks                     | https://www.youtube.com/user/emacsrocks/videos"
    "Flux Harmonic                   | https://www.youtube.com/c/FluxHarmonicLive/videos"
#    "FreeDOS                         | https://www.youtube.com/c/FreeDOSProject/videos"
#    "GeekBits                        | https://www.youtube.com/c/GeekBits/videos"
#    "Handheld Computing              | https://www.youtube.com/c/HandheldComputing/videos"
    "Hey Birt                        | https://www.youtube.com/c/HeyBirt/videos"
#    "Jake B                          | https://www.youtube.com/c/JakeBox0/videos"
#    "James Sharman                   | https://www.youtube.com/c/weirdboyjim/videos"
#    "LGR                             | https://www.youtube.com/c/Lazygamereviews/videos"
#    "LGR Blerbs                      | https://www.youtube.com/c/LGRBlerbs/videos"
    "Lukewh, Emacs                   | https://www.youtube.com/playlist?list=PLNJWazvift25KnHDwYlhwrrgr60wtpQOB"
#    "Mac84                           | https://www.youtube.com/c/Mac84/videos"
#    "Matt Heffernan Slithy Games     | https://www.youtube.com/c/slithymatt/videos"
    "Me, Myself, and Die             | https://www.youtube.com/c/MeMyselfandDieRPG/videos"
#    "PhilsComputerLab                | https://www.youtube.com/c/philscomputerlab/videos"
    "Protesilaos Stavrou             | https://www.youtube.com/c/ProtesilaosStavrou/videos"
#    "Retro Hack Shack                | https://www.youtube.com/c/RetroHackShack/videos"
#    "Retro Recipes                   | https://www.youtube.com/c/Perifractic/videos"
#    "RMC, The Cave                   | https://www.youtube.com/c/RMCRetro/videos"
    "System Crafters                 | https://www.youtube.com/c/SystemCrafters/videos"
    "The 8-Bit Guy                   | https://www.youtube.com/c/The8BitGuy/videos"
#    "The Retro Shack                 | https://www.youtube.com/c/TheRetroShack/videos"
#    "TheGeekPub                      | https://www.youtube.com/c/TheGeekPub/videos"
    "Tsoding Daily                   | https://www.youtube.com/c/TsodingDaily/videos"
)

if [[ "$1" == "-h" ]] || [[ "$1" == "--help" ]] ; then
    cat <<EOF
Usage: $(basename $0) [--restart]
Grab the latest YouTube videos from a curated list.
  --list         - Display video list names
  --restart      - Download any missing videos from all lists
  --restart LIST - Download any missing videos from LIST name
EOF
    exit 1
fi

if [[ "$1" == "--list" ]] ; then
    for ((x = 0; x < ${#channels[@]}; x += 1)) ; do
        echo "${channels[$x]}" | sed 's/ *|.*$//'
    done
    exit 0
fi

mkdir -p "${tempdir}"
for ((x = 0; x < ${#channels[@]}; x += 1)) ; do
    name=$(echo "${channels[$x]}" | sed 's/ *|.*$//')
    url=$(echo "${channels[$x]}" | sed 's/^.*| *//')
    echo "${url} -> ${basedir}/${name}"
    mkdir -p "${basedir}/${name}"
    count=$(find "${basedir}/${name}" -type f | wc -l)
    [[ "$1" == "--restart" ]] && [[ -z "$2" || "$2" == "${name}" ]] && count=0
    start=""
    [[ ${count} -gt 0 ]] && start="--playlist-start ${count}"
    cd "${basedir}/${name}" && \
        yt-dlp --format "bv+ba/b" \
               --playlist-reverse \
               ${start} \
               --paths "temp:${tempdir}" \
               --output "${name} - %(release_date>%Y-%m-%d,upload_date>%Y-%m-%d|Unknown)s - %(title)s.%(ext)s" \
               "${url}"
done
rmdir "${tempdir}"

#===============================================================================
# End of File
#===============================================================================
