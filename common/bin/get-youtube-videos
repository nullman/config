#!/usr/bin/env bash
#===============================================================================
# get-youtube-videos
#
# Grab the latest YouTube videos from a curated list.
#
# Author: Kyle W T Sherman
#===============================================================================

basedir="/mnt/synology/video"

channels=(
#   "8-Bit Keys                       | Internet Show  | https://www.youtube.com/c/8BitKeys/videos"
#   "8-Bit Show And Tell              | Internet Show  | https://www.youtube.com/c/8BitShowAndTell/videos"
#   "Action Retro                     | Internet Show  | https://www.youtube.com/c/ActionRetro/videos"
    "Adrian's Digital Basement        | Internet Show  | https://www.youtube.com/c/adriansdigitalbasement/videos"
    "Adrian's Digital Basement ][     | Internet Show  | https://www.youtube.com/channel/UCbtwi4wK1YXd9AyV_4UcE6g/videos"
#   "Back Office Show                 | Internet Show  | https://www.youtube.com/c/backofficeshow/videos"
    "Ben Eater                        | Internet Show  | https://www.youtube.com/c/BenEater/videos"
#   "Ben Heck Hacks                   | Internet Show  | https://www.youtube.com/c/BenHeckHacks/videos"
#   "Blue OS Museum                   | Internet Show  | https://www.youtube.com/channel/UCO6vmCYZl7ZhEydFGi76iaw/videos"
#   "Chyrosran22                      | Internet Show  | https://www.youtube.com/user/Chyrosran22/videos"
#   "Commodore Amiga Demos            | Internet Show  | https://www.youtube.com/playlist?list=PLnmLOQIDmUvUgbvY-Jq0txuYWYgWVcOOS"
#   "Commodore 64 Demos               | Internet Show  | https://www.youtube.com/playlist?list=PLnmLOQIDmUvVn43FHdakSTY_W_EuoVwnT"
#   "Dave's Garage                    | Internet Show  | https://www.youtube.com/c/DavesGarage/videos"
#   "Doctor Volt                      | Internet Show  | https://www.youtube.com/c/DoctorVolt/videos"
#   "DUST                             | Internet Show  | https://www.youtube.com/c/watchdust/videos"
#   "EmacsConf                        | Internet Show  | https://www.youtube.com/c/EmacsConf/videos"
#   "Emacs Rocks                      | Internet Show  | https://www.youtube.com/user/emacsrocks/videos"
    "Flux Harmonic                    | Internet Show  | https://www.youtube.com/c/FluxHarmonicLive/videos"
#   "FreeDOS                          | Internet Show  | https://www.youtube.com/c/FreeDOSProject/videos"
#   "GeekBits                         | Internet Show  | https://www.youtube.com/c/GeekBits/videos"
#   "Handheld Computing               | Internet Show  | https://www.youtube.com/c/HandheldComputing/videos"
    "Hey Birt                         | Internet Show  | https://www.youtube.com/c/HeyBirt/videos"
#   "Jake B                           | Internet Show  | https://www.youtube.com/c/JakeBox0/videos"
#   "James Sharman                    | Internet Show  | https://www.youtube.com/c/weirdboyjim/videos"
#   "Jan Beta                         | Internet Show  | https://www.youtube.com/c/JanBeta"
#   "LGR                              | Internet Show  | https://www.youtube.com/c/Lazygamereviews/videos"
#   "LGR Blerbs                       | Internet Show  | https://www.youtube.com/c/LGRBlerbs/videos"
    "Lukewh, Emacs                    | Internet Show  | https://www.youtube.com/playlist?list=PLNJWazvift25KnHDwYlhwrrgr60wtpQOB"
#   "Mac84                            | Internet Show  | https://www.youtube.com/c/Mac84/videos"
#   "Matt Heffernan Slithy Games      | Internet Show  | https://www.youtube.com/c/slithymatt/videos"
    "Me, Myself, and Die              | Internet Show  | https://www.youtube.com/c/MeMyselfandDieRPG/videos"
#   "Noel's Retro Lab                 | Internet Show  | https://www.youtube.com/c/NoelsRetroLab/videos"
#   "Paul Scinocca (Duluth Ships)     | Internet Video | https://www.youtube.com/c/PaulScinocca/videos"
    "PhilsComputerLab                 | Internet Show  | https://www.youtube.com/c/philscomputerlab/videos"
    "Protesilaos Stavrou              | Internet Show  | https://www.youtube.com/c/ProtesilaosStavrou/videos"
#   "Retro Hack Shack                 | Internet Show  | https://www.youtube.com/c/RetroHackShack/videos"
#   "Retro Recipes                    | Internet Show  | https://www.youtube.com/c/Perifractic/videos"
#   "root42                           | Internet Show  | https://www.youtube.com/c/root42/videos"
#   "RMC, The Cave                    | Internet Show  | https://www.youtube.com/c/RMCRetro/videos"
    "System Crafters                  | Internet Show  | https://www.youtube.com/c/SystemCrafters/videos"
    "Tech Tangents                    | Internet Show  | https://www.youtube.com/c/AkBKukU/videos"
#   "Techmoan                         | Internet Show  | https://www.youtube.com/c/Techmoan/videos"
    "The 8-Bit Guy                    | Internet Show  | https://www.youtube.com/c/The8BitGuy/videos"
#   "The Centre for Computing History | Internet Show  | https://www.youtube.com/c/TheCentreforComputingHistory/videos"
#   "The Phintage Collector           | Internet Show  | https://www.youtube.com/c/THEPHINTAGECOLLECTOR/videos"
#   "The Retro Shack                  | Internet Show  | https://www.youtube.com/c/TheRetroShack/videos"
#   "TheGeekPub                       | Internet Show  | https://www.youtube.com/c/TheGeekPub/videos"
#   "This Does Not Compute            | Internet Show  | https://www.youtube.com/c/ThisDoesNotCompute/videos"
    "Tsoding Daily                    | Internet Show  | https://www.youtube.com/c/TsodingDaily/videos"
#   "Usagi Electric                   | Internet Show  | https://www.youtube.com/c/Nakazoto/videos"
#   "Vsauce2                          | Internet Show  | https://www.youtube.com/user/Vsauce2/videos"
)

_usage() {
    cat <<EOF
Usage: $(basename $0) [OPTIONS] [CHANNEL]
Grab the latest YouTube videos from a curated list.
  OPTIONS:
  -l, --list             display video list names
  -r, --restart          download any missing videos from all lists
  -r, --restart CHANNEL  download any missing videos from CHANNEL
  -h, --help             show help (this message)
  CHANNEL                download videos from CHANNEL
EOF
}

_download() {
    archive="$1"
    listname="$2"

    [[ -n "${listname}" ]] && echo "List: ${listname}"

    for ((x = 0; x < ${#channels[@]}; x += 1)) ; do
        channel=$(echo "${channels[$x]}" | sed 's/ *|/|/g ; s/| */|/g')
        name=$(echo "${channel}" | cut -d '|' -f 1)
        dir=$(echo "${channel}" | cut -d '|' -f 2)
        url=$(echo "${channel}" | cut -d '|' -f 3)
        echo "|${name}|${dir}|${url}|"
        if [[ -z "${listname}" || "${name}" == "${listname}" ]] ; then
            path="${basedir}/${dir}/${name}"
            echo
            echo "${url} -> ${path}"
            echo
            mkdir -p "${path}"
            cd "${path}" && \
                yt-dlp --format "bv*+ba/b" \
                       --format-sort "res:1080,res:720,res:480" \
                       --playlist-reverse \
                       ${archive} \
                       --output "${name} - %(release_date>%Y-%m-%d,upload_date>%Y-%m-%d|Unknown)s - %(title)s.%(ext)s" \
                       "${url}"
        fi
    done
}

archive="--download-archive ${HOME}/.yt-dlp-download-archive"

# handle command line arguments
while true ; do
    case $1 in
        -l|--list)
            for ((x = 0; x < ${#channels[@]}; x += 1)) ; do
                echo "${channels[$x]}" | sed 's/ *|.*$//'
            done
            exit 0
            ;;
        -r|--restart)
            listname=
            if [[ -n "$2" ]] ; then
                listname="$2"
                shift
            fi
            archive="--no-download-archive"
            _download "${archive}" "${listname}"
            exit 0
            ;;
        -h|-\?|--help)
            _usage 0
            exit 0
            ;;
        --)
            shift
            break
            ;;
        -?*)
            echo -e "Invalid option: $1" >&2
            _usage
            exit 1
            ;;
        *)
            break
            ;;
    esac
    shift
done

listname=
[[ -n "$1" ]] && listname="$1"
_download "${archive}" "${listname}"

exit 0

#===============================================================================
# End of File
#===============================================================================
