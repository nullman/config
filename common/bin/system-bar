#!/usr/bin/env bash
#===============================================================================
# system-bar
#
# Launch system bar and system bar applets in the background.
#
# Author: Kyle W T Sherman <kylewsherman@gmail.com>
#===============================================================================

# delay before launching applets
delay=0

# run executable command if found in the path
_run() {
    command -v "$1" >/dev/null 2>&1 && "$@"
}

# run executable command if found in the path and not already running
_once() {
    if command -v "$1" >/dev/null 2>&1 && ! pidof -q "$1" ; then
        "$@" &
    fi
}

# delay running a command (SECONDS COMMAND)
_delay() {
    local delay=$1
    shift
    sleep ${delay} && eval "$@"
}

# system bar
#pkill -u ${USER} polybar ; _once polybar -c ${HOME}/.config/polybar/config openbox-bar &
#(pkill -u ${USER} tint2 ; _once tint2 && sleep 1 && xdo below -t $(xdo id -n root) $(xdo id -N Tint2)) & # status bar hidden when fullscreen
#(_run eww --restart open bar && sleep 1 && xdo below -t $(xdo id -n root) $(xdo id -n eww)) & # status bar hidden when fullscreen
#pkill -u ${USER} xfce4-panel ; _once xfce4-panel --disable-wm-check &
pkill -u ${USER} polybar ; _once polybar &

# system bar applets
#(_delay ${delay} pkill -u ${USER} clipit ; _once clipit) &
(_delay ${delay} pkill -u ${USER} pa-applet ; _once pa-applet) &
(_delay ${delay} pkill -u ${USER} blueman-applet ; _once blueman-applet) &
(_delay ${delay} pkill -u ${USER} nm-applet ; _once nm-applet) &
#(_delay ${delay} pkill -u ${USER} pamac-tray ; _once pamac-tray) &
if [ -e "/sys/class/power_supply/BAT0" ] ; then
    (_delay ${delay} pkill -u ${USER} xfce4-power-manager ; _once xfce4-power-manager) &
fi
#(_delay ${delay} pkill -u ${USER} volumeicon ; _once volumeicon) &
#(_delay ${delay} pkill -u ${USER} sbxkb ; _once sbxkb) &
#(_delay ${delay} pkill -u ${USER} kdeconnect-indicator ; _once kdeconnect-indicator) &
(_delay ${delay} pkill -u ${USER} localsend ; _once localsend --hidden) &

#===============================================================================
# End of File
#===============================================================================
