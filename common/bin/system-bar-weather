#!/usr/bin/env bash
if [ $# -ne 2 ] || ([ "$1" != "status" ] && [ "$1" != "icon" ] && [ "$1" != "both" ] && [ "$1" != "full" ]) ; then
    echo "Usage: $(basename $0) (status|icon|both|full) LOCATION"
    echo "  status    Return short text description"
    echo "  icon      Return icon and temperature"
    echo "  both      Return both icon and short text"
    echo "  full      Return all information"
    echo "  LOCATION  City or ZIP Code"
    exit 1
fi

type="$1"
shift
loc="$*"
data="$(curl --silent 'wttr.in/'"${loc}"'?uT&format=+%C|+%t|+%w|+%p|+%P|+%u|+%m' | sed 's/^ // ; s/| /|/g')"
desc=$(echo "${data}" | cut -d '|' -f 1)
temp=$(echo "${data}" | cut -d '|' -f 2)
wind=$(echo "${data}" | cut -d '|' -f 3)
prec=$(echo "${data}" | cut -d '|' -f 4)
pres=$(echo "${data}" | cut -d '|' -f 5)
uv=$(echo "${data}" | cut -d '|' -f 6)
moon=$(echo "${data}" | cut -d '|' -f 7)

case "${desc}" in
    "Light rain") icon="" ;;
    "Light snow") icon="" ;;
    "Mist") icon="?" ;;
    "Overcast") icon="" ;;
    "Partly cloudy") icon="" ;;
    "Sunny") icon="" ;;
    *) notify-send -u critical "Unknown weather: ${desc}" ; echo "Unknown weather: ${desc}" >> ~/weather-errors ;;
esac

case "moon" in
    "🌑") moon="" ;;
    "🌒") moon="" ;;
    "🌓") moon="" ;;
    "🌔") moon="" ;;
    "🌕") moon="" ;;
    "🌖") moon="" ;;
    "🌗") moon="" ;;
    "🌘") moon="" ;;
esac

#echo "${data}"

case "${type}" in
    "status") printf '%s  %s' "${temp}" "${desc}" ;;
    "icon") printf '%s  %s' "${icon}" "${temp}" ;;
    "both") printf '%s  %s  %s' "${icon}" "${temp}" "${desc}" ;;
    "full") printf 'Icon: %s\nTemperature: %s\nDescription: %s\nWind: %s\nPrecipitation: %s\nPressure: %s\nUV: %s\nMoon: %s\n' "${icon}" "${temp}" "${desc}" "${wind}" "${prec}" "${pres}" "${uv}" "${moon}" ;;
esac
