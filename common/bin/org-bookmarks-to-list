#!/usr/bin/env bash
#===============================================================================
# org-bookmarks-to-list
#
# Convert an org file containing a tree of URL bookmarks to a list.
#
# Author: Kyle W T Sherman <kylewsherman@gmail.com>
#===============================================================================

set -euo pipefail

file="${HOME}/org/bookmarks.org"

path=()
level=0

cat "${file}" | sed '0,/^\* Bookmarks Menu$/d ; /^\* Other Bookmarks$/,$d' | \
    while read -r line ; do
        if [[ "${line:0:1}" == "*" ]] ; then
            head=$(echo "${line}" | sed 's/ .*$//')
            level=$(((${#head} - 1) / 2))
            while [[ ${#path[@]} -lt ${level} ]] ; do path+=("") ; done
            while [[ ${#path[@]} -gt ${level} ]] ; do unset path[$((${#path[@]} - 1))] ; done
            path[level]=$(echo "${line}:" | sed 's/^\** //')
        else
            url=$(echo "${line}" | sed 's/ *//')
            res="${path[*]} ${url}"
            printf '%s\n' "${res:1}"
        fi
    done

exit 0

#===============================================================================
# End of File
#===============================================================================
